
<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C# 程式設計 -- 基礎、視窗與網路 >>  C# 視窗程式：DataGridView 與 ListView 元件</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/pure-min.css">
    <link rel="stylesheet" href="../../book.css">
</head>
<body>

<div class="header pure-menu pure-menu-horizontal">
  <ul id="topBar" class="pure-menu-list">
    <li id="bookTitle" class="pure-menu-item"><a href="README.html" class="pure-menu-link">C# 程式設計 -- 基礎、視窗與網路</a></li>
  </ul>
</div>

<div id="layout">
  <a href="#menu" id="menuLink" class="menu-link"><span></span></a>
  <div id="menu">
    <div id="sideMenu" class="pure-menu">
      <div id="home" class="pure-menu-heading">
        <a href="../../index.html">⮌</a>
      </div>
      <ul class="pure-menu-list" id="bookBox"><li class="pure-menu-item"><a href="README.html" class="pure-menu-link">目錄</a></li>
<li class="pure-menu-item"><a href="csharp.html" class="pure-menu-link">1. 簡介</a></li>
<li class="pure-menu-item"><a href="varexp.html" class="pure-menu-link">2. 運算式</a></li>
<li class="pure-menu-item"><a href="ifloop.html" class="pure-menu-link">3. 流程控制</a></li>
<li class="pure-menu-item"><a href="array.html" class="pure-menu-link">4. 陣列</a></li>
<li class="pure-menu-item"><a href="function.html" class="pure-menu-link">5. 函數</a></li>
<li class="pure-menu-item"><a href="object.html" class="pure-menu-link">6. 物件導向</a></li>
<li class="pure-menu-item"><a href="exception.html" class="pure-menu-link">7. 例外處理</a></li>
<li class="pure-menu-item"><a href="file.html" class="pure-menu-link">8. 檔案處理</a></li>
<li class="pure-menu-item"><a href="datastructure.html" class="pure-menu-link">9. 資料結構</a></li>
<li class="pure-menu-item"><a href="regexp.html" class="pure-menu-link">10. 正規表達式</a></li>
<li class="pure-menu-item"><a href="thread.html" class="pure-menu-link">11. 作業系統</a></li>
<li class="pure-menu-item"><a href="window.html" class="pure-menu-link">12. 視窗程式</a></li>
<li class="pure-menu-item"><a href="timer.html" class="pure-menu-link">13. 時間驅動</a></li>
<li class="pure-menu-item"><a href="editor.html" class="pure-menu-link">14. 文字編輯器</a></li>
<li class="pure-menu-item"><a href="graphics.html" class="pure-menu-link">15. 畫圖功能</a></li>
<li class="pure-menu-item"><a href="gridview.html" class="pure-menu-link">16. 表格元件</a></li>
<li class="pure-menu-item"><a href="net.html" class="pure-menu-link">17. 網路程式</a></li>
<li class="pure-menu-item"><a href="udp.html" class="pure-menu-link">18. UDP 程式</a></li>
<li class="pure-menu-item"><a href="tcp.html" class="pure-menu-link">19. TCP 程式</a></li>
<li class="pure-menu-item"><a href="http.html" class="pure-menu-link">20. HTTP Server</a></li>
<li class="pure-menu-item"><a href="web.html" class="pure-menu-link">21. HTTP Client</a></li>
<li class="pure-menu-item"><a href="end.html" class="pure-menu-link">結語</a></li></ul>
    </div>
  </div>
  <div id="main">
    <div class="content" id="viewBox">
      <div id="mdBox"><h1 id="c-datagridview-listview-">C# 視窗程式：DataGridView 與 ListView 元件</h1>
<h2 id="datagridview-">DataGridView 的使用</h2>
<p>在微軟 .NET 的架構中，DataGridView 是一個強大而複雜的元件，我們欣賞其功能的強大，但也相當畏懼其複雜性，有時我們並不想將這個元件與資料庫綁在一起使用，但是卻不知道應該如何直接在元件中填入表格資料，以下是這個問題的一個簡單解法。</p>
<p>專案下載：<a href="https://dl.dropbox.com/u/101584453/cs/code/MenuGridView.zip">https://dl.dropbox.com/u/101584453/cs/code/MenuGridView.zip</a></p>
<p>設計：當您用 Visual Studio 拉出一個 DataGridView 物件 (假設稱為 dataGridViewMenu) 後，可以點選其屬性中的 Columns 欄位，然後用視覺化的方式加入兩個 Column，並設定好名稱為 name (品名), price (單價)，以下是筆者設定時的畫面。</p>
<p><img src="MenuGridViewColumn.png" alt="DataGridView 的設計介面"></p>
<p>授課錄影：C# DataGridView 元件的使用 -- <a href="http://youtu.be/XzsZRqLAi30">http://youtu.be/XzsZRqLAi30</a></p>
<h2 id="-point-of-sale-pos-">賣泡沫紅茶的系統 (Point of Sale, POS)</h2>
<p>授課錄影：</p>
<ul>
<li>C# 製作賣紅茶的 POS 系統 -- <a href="http://youtu.be/XX0wHhvkkiE">http://youtu.be/XX0wHhvkkiE</a></li>
<li>設計飲料店點菜系統 (1/2: 介面設計) -- <a href="http://youtu.be/4NRzpSNLQ44">http://youtu.be/4NRzpSNLQ44</a></li>
<li>設計飲料店點菜系統 (2/2: 程式邏輯) -- <a href="http://youtu.be/KO6fENU5Yfo">http://youtu.be/KO6fENU5Yfo</a></li>
</ul>
<p>為了展示如何用 C# 設計一個小型的銷售點系統，我們設計了一個販賣飲料的 POS 軟體，可以讓販售者於電腦上點選飲料與數量，然後系統會自動計算總金額，這個程式可以用 ListView 或 DataGridView 元件進行設計，在上述的專案下載連結中，我們分別設計了這些專案，以下說明是我們使用 DataGridView 的設計方式的結果。</p>
<p>專案下載：</p>
<ul>
<li>簡易版 -- <a href="https://dl.dropbox.com/u/101584453/cs/code/Menu1.zip">https://dl.dropbox.com/u/101584453/cs/code/Menu1.zip</a> (只有一樣商品：紅茶)</li>
<li>完整版 -- <a href="https://dl.dropbox.com/u/101584453/cs/code/Menu2.zip">https://dl.dropbox.com/u/101584453/cs/code/Menu2.zip</a> (使用 ListView)</li>
<li>豪華版 -- <a href="https://dl.dropbox.com/u/101584453/cs/code/POS2012.zip">https://dl.dropbox.com/u/101584453/cs/code/POS2012.zip</a> (2012 年更新版，使用 DataGridView)</li>
</ul>
<p><img src="MenuDesign.png" alt="賣泡沫紅茶的系統的畫面設計"></p>
<p>程式碼</p>
<pre><code class="lang-CS">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace POS
{
    public partial class FormMenu : Form
    {
        String name; // 品名
        double price; // 單價
        double number; // 數量
        double subTotal; // 小計

        public FormMenu()
        {
            InitializeComponent();

            // 填入銷售項目到菜單中
            DataGridViewRowCollection rows = dataGridViewMenu.Rows;
            rows.Add(new Object[] { &quot;紅茶&quot;, 25 }); 
            rows.Add(new Object[] { &quot;綠茶&quot;, 25 });
            rows.Add(new Object[] { &quot;奶茶&quot;, 30 });
            rows.Add(new Object[] { &quot;珍珠奶茶&quot;, 35 });
        }

        private void dataGridViewMenu_CellClick(object sender, DataGridViewCellEventArgs e)
        {
            // 選取某項目，將該項目的品名價格放入待購項目中。
            if (dataGridViewMenu.Rows[e.RowIndex].Cells[0].Value == null)
                return;
            buttonName.Text = dataGridViewMenu.Rows[e.RowIndex].Cells[0].Value.ToString();
            textBoxPrice.Text = dataGridViewMenu.Rows[e.RowIndex].Cells[1].Value.ToString();
        }

        private void buttonAdd_Click(object sender, EventArgs e)
        {
            // 加入紐被按下
            calculateSubTotal(); // 計算小計，並加入到訂單中
            dataGridViewOrder.Rows.Add(new Object[] { name, price, number, subTotal }); 
            calculateTotal(); // 重新計算總價
        }

        private void calculateSubTotal() // 計算小計
        {
            name = buttonName.Text;
            price = double.Parse(textBoxPrice.Text);
            number = (double)numericUpDownNumber.Value;
            subTotal = price * number; // 小計 = 價格 * 數量
            textBoxSubtotal.Text = subTotal.ToString();
        }

        private void calculateTotal() // 計算總價
        {
            double total = 0.0;
            for (int i = 0; i &lt; dataGridViewOrder.Rows.Count; i++)
            {
                DataGridViewRow row = dataGridViewOrder.Rows[i];
                if (row.Cells[0].Value != null)
                    total += (double)row.Cells[3].Value;
            }
            textBoxTotal.Text = total.ToString();
        }

        private void numericUpDownNumber_ValueChanged(object sender, EventArgs e)
        {
            calculateSubTotal(); // 數量修改時，重新計算小計。
        }

        private void buttonTotal_Click(object sender, EventArgs e)
        {
            calculateTotal(); // 按下總價紐時，重新計算總價。
        }
    }
}
</code></pre>
<p>執行結果</p>
<p><img src="MenuRun.png" alt="賣泡沫紅茶的系統的執行結果"></p>
<h2 id="-">參考文獻</h2>
<ul>
<li>Data Binding in .NET / C# Windows Forms -- <a href="http://www.akadia.com/services/dotnet_databinding.html">http://www.akadia.com/services/dotnet_databinding.html</a></li>
<li>C# DataRow Examples -- <a href="http://dotnetperls.com/datarow">http://dotnetperls.com/datarow</a></li>
<li>How to bind a DataGridView to a DataSet without a database? -- <a href="http://www.devnewsgroups.net/windowsforms/t57859-how-bind-datagridview-dataset-without-database.aspx">http://www.devnewsgroups.net/windowsforms/t57859-how-bind-datagridview-dataset-without-database.aspx</a></li>
<li>Data Binding in DataGrid Control - Part 1 -- <a href="http://www.c-sharpcorner.com/UploadFile/mahesh/DataBindingInDataGridMCB112022005002207AM/DataBindingInDataGridMCB1.aspx">http://www.c-sharpcorner.com/UploadFile/mahesh/DataBindingInDataGridMCB112022005002207AM/DataBindingInDataGridMCB1.aspx</a></li>
</ul>
</div>
      <div style="text-align:center">
        <span class="footnote">
        
        </span>
      </div>
    </div>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script src="../../book.js"></script>
</body>
</html>
